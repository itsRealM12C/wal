<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>webOS SSAP App List</title>
  <style>
    body { background:#0b0b0b; color:#eee; font-family:Arial,sans-serif; text-align:center; padding:24px }
    h2 { margin-bottom:20px }
    button { padding:12px 20px; border-radius:8px; border:1px solid #555; background:#222; color:#fff; cursor:pointer }
    #apps { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top:25px }
    .app { width:150px; text-align:center }
    .app img { width:80px; height:80px; object-fit:contain; border-radius:12px; background:#222; display:block; margin:0 auto 8px }
    .app span { font-size:14px; color:#ccc }
  </style>
</head>
<body>
  <h2>üì∫ Installed Apps</h2>
  <button id="fetch">Fetch Apps (Enter)</button>
  <div id="apps"></div>

  <!-- SSAP websocket libs -->
  <script src="https://dropbox.inf.re/webos-gfn/wsproxy.js"></script>
  <script src="https://dropbox.inf.re/webos-gfn/client.js"></script>

  <script>
    let ssapClient;

    async function initClient() {
      const target = "ws://127.0.0.1:3000"; // SSAP runs here on TV
      ssapClient = new SSAPClient("127.0.0.1", localStorage["client-key-127.0.0.1"]);
      await ssapClient.connect();
      localStorage["client-key-127.0.0.1"] = await ssapClient.register();
    }

    async function fetchApps() {
      try {
        if (!ssapClient) await initClient();

        const response = await ssapClient.request({
          uri: "ssap://com.webos.applicationManager/listApps"
        });

        const container = document.getElementById("apps");
        container.innerHTML = "";

        if (response && response.apps) {
          response.apps.forEach(app => {
            const div = document.createElement("div");
            div.className = "app";
            const img = document.createElement("img");
            img.src = app.icon || "";
            const span = document.createElement("span");
            span.textContent = app.title || app.id;
            div.appendChild(img);
            div.appendChild(span);
            container.appendChild(div);
          });
        } else {
          container.innerHTML = "<p>‚ùå No apps found or invalid response.</p>";
        }
      } catch (err) {
        console.error(err);
        document.getElementById("apps").innerHTML = "<p>Error: " + err + "</p>";
      }
    }

    document.getElementById("fetch").addEventListener("click", fetchApps);
    window.addEventListener("keydown", ev => {
      if (ev.key === "Enter") { ev.preventDefault(); fetchApps(); }
    });
  </script>
</body>
</html>
